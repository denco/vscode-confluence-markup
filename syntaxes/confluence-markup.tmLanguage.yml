fileTypes:
    - confluence
    - markup
    - wiki
firstLineMatch: confluence
keyEquivalent: ^~C
name: Confluence markup
scopeName: text.html.confluence
patterns:
    - include: "#paragraph"
repository:
    paragraph:
        # name: meta.paragraph.confluence
        name: text.html.paragraph.confluence
        begin: ^
        end: ^$
        patterns:
            - include: "#escape-char"
            - include: "#hr"
            - include: "#heading"
            - include: "#table"
            - include: "#lists"
            - include: "#inline"
    escape-char:
        name: markup.constant.escape.confluence
        match: (\\)
        captures:
            "1":
                name: meta.ignore.escape.confluence
    hr:
        name: markup.hr.confluence
        match: ^\s*(-{4,})\s*$
        captures:
            "1":
                name: meta.tag.hr.confluence
    heading:
        name: markup.heading.confluence
        match: (?:^|\G)((h[1-6])(\.\s+)(.*?)(\s+)?\s*)$
        captures:
            "2":
                name: meta.tag.$2.confluence
            "3":
                name: meta.ignore.$2.confluence
            "4":
                name: text.html.heading.confluence
                patterns:
                    - include: "#inline"
    table:
        name: markup.other.table.confluence
        begin: ^\s*(?=\|)
        end: ^(?!\s*\|)
        patterns:
            -   name: markup.other.table.header.confluence
                begin: \|\|
                beginCaptures:
                    "0":
                        name: punctuation.definition.table.header.confluence
                end: (?=\|\|?|\n)
                patterns:
                    - include: "#inline"
            -   name: markup.other.table.cell.confluence
                begin: \|(?!\|)
                beginCaptures:
                    "0":
                        name: punctuation.definition.table.cell.confluence
                end: (?=\||\n)
                patterns:
                    - include: "#inline"
    lists:
        name: markup.other.list.confluence
        begin: ^\s*([-\*#]+)(\s)(.*)
        end: ^(\s*|$)
        beginCaptures:
            "1":
                patterns:
                    -   name: meta.tag.ul.confluence
                        match: (^[-\*#]*\*$)
                    -   name: meta.tag.ul.alt.confluence
                        match: (^[-\*#]*-$)
                    -   name: meta.tag.ol.confluence
                        match: (^[-\*#]*#$)
            "2":
                name : text.html.list.element.confluence
            "3":
                name : text.html.content.element.confluence
                patterns:
                    - include: "#inline"
        endCaptures:
            "0":
                name: markup.tag.end.list.confluence
    inline:
        patterns:
            - include: "#link"
            - include: "#line-break"
            - include: "#mdash"
            - include: "#ndash"
            - include: "#emoticon"
            - include: "#bold"
            - include: "#italic"
            - include: "#citation"
            - include: "#inserted"
            - include: "#superscript"
            - include: "#subscript"
            - include: "#deleted"
            - include: "#monospaced"
    link:
        name: markup.link.confluence
        # match: (\[)(?:([^|\s]*?)(\|))?([^\[]*?[^\\|\s])(\])
        match: (\[)(?:([^|]*?)(\|))?([^\[]*?[^\\|\s])(\])
        captures:
            "1" :
                name: meta.tag.a.confluence
            "2" :
                name: text.html.link.element.confluence
                patterns:
                    - include: "#inline"
            "4" :
                name: meta.attribute.href.confluence
            "5" :
                name: meta.close.a.confluence
    line-break:
        name: markup.line-break.confluence
        match: (\\\\)
        captures:
            "1" :
                name: meta.tag.br.confluence
    mdash:
        name: markup.mdash.confluence
        match: \B(-{3})\B
        captures:
            "1":
                name: text.html.mdash.element.confluence
    ndash:
        name: markup.ndash.confluence
        match: \B(-{2})\B
        captures:
            "1":
                name: text.html.ndash.element.confluence
    emoticon:
        name: markup.emoticon.confluence
        match: (\B)(:P|:D|:\)|:\(|;\)|\(y\)|\(n\)|\(i\)|\(\/\)|\(x\)|\(!\)|\(\?\)|\(-\)|\(\+\)|\(on\)|\(off\)|\(\*\)|\(\*r\)|\(\*g\)|\(\*b\)|\(\*y\)|\(flagoff\)|\(flagon\))\1
        captures:
            "2" :
                name: text.html.image.emoticon.confluence
    bold:
        name: markup.bold.confluence
        match: (\*)([^\*]*)(\1)
        captures:
            "1":
                name: meta.tag.strong.confluence
            "2":
                name: text.html.bold.element.confluence
                patterns:
                    - include: "#inline"
            "3":
                name: meta.close.strong.confluence
    italic:
        name: markup.italic.confluence
        match: (\b_|\{_\})([^_]*)(_)
        captures:
            "1":
                name: meta.tag.i.confluence
            "2":
                name: text.html.italic.element.confluence
                patterns:
                    - include: "#inline"
            "3":
                name: meta.close.i.confluence
    citation:
        name: markup.citation.confluence
        match: (\?{2})(.*)(\1)
        captures:
            "1":
                name: meta.tag.cite.confluence
            "2":
                name: text.html.citation.element.confluence
                patterns:
                    - include: "#inline"
            "3":
                name: meta.close.cite.confluence
    inserted:
        name: markup.inserted.confluence
        match: (\+)(.*)(\1)
        captures:
            "1":
                name: meta.tag.ins.confluence
            "2":
                name: text.html.inserted.element.confluence
                patterns:
                    - include: "#inline"
            "3":
                name: meta.close.ins.confluence
    superscript:
        name: markup.superscript.confluence
        match: (\^)([^\^]*)(\1)
        captures:
            "1":
                name: meta.tag.sup.confluence
            "2":
                name: text.html.superscript.element.confluence
                patterns:
                    - include: "#inline"
            "3":
                name: meta.close.sup.confluence
    subscript:
        name: markup.subscript.confluence
        match: (~)([^~]*)(\1)
        captures:
            "1":
                name: meta.tag.sub.confluence
            "2":
                name: text.html.subscript.element.confluence
                patterns:
                    - include: "#inline"
            "3":
                name: meta.close.sub.confluence
    deleted:
        name: markup.deleted.confluence
        match: \B(-)(.*)(\1)\B
        captures:
            "1":
                name: meta.tag.del.confluence
            "2":
                name: text.html.deleted.element.confluence
                patterns:
                    - include: "#inline"
            "3":
                name: meta.close.del.confluence
    monospaced:
        name: markup.raw.confluence
        match: (\{{2})(.*?)(\}{2})
        captures:
            "1":
                name: meta.tag.code.confluence
            "2":
                name: text.html.raw.element.confluence
            "3":
                name: meta.close.code.confluence
uuid: 2D045A75-E4D7-4904-8766-D6234F10FCA1
